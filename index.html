<!DOCTYPE html>
<html>
  <head>
    <title>Building for automation</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1,width=device-width"
    />
    <link rel="stylesheet" type="text/css" href="./css/typo.css" />
    <link rel="stylesheet" type="text/css" href="./css/nord-dark.css" />
    <link rel="stylesheet" type="text/css" href="./css/font-nord.css" />
    <link rel="stylesheet" type="text/css" href="./css/bg-nord.css" />
    <link rel="stylesheet" type="text/css" href="./css/style.css" />
  </head>
  <body>
    <textarea id="source">
class: nord-dark, center, middle, title

# SUPER HAPPY FUNTIME PRESENTATION THAT SOLVES SECURITY FOREVER

---

class: nord-dark, left, middle

## Mike Williamson

* HC ITsec > startups > CDS > TBSCyber

---

class: nord-dark, left, middle

## Tyler Parrott

* Senior IT Security Analyst @CCCS
* Part of team that open sourced Assemblyline
* Team Lead for CCCS Tracker collaboration

---

class: nord-dark, left, middle

## TBS ğŸ¤ CCCS

---
class: nord-dark, left, middle

## Tracker 1.0

* HTTPS/SSL metrics only
* cumbersome domain management (.csv!)
* poor performance/scaling
* difficult to iterate upon

.sync.eighty[![https-everywhere](images/https-everywhere.png)]

---

class: nord-dark, left, middle

## Tracker 2.0

* Developed following	Directive on Service and Digital
* User based domain management
* Orchestrated scanning for efficient resource usage/scaling
* DMARC/SPF/DKIM added, easy to extend
* DMARC Aggregate report dashboard
* Tailored guidance based on scan results
* Continuous monitoring to enable strong posture
* Powerful tool for deployment pipeline

.sync.eighty[![tracker](images/tracker-demo.gif)]

---

class: nord-dark, middle, left

### The path to security automation enlightenment

---

class: nord-dark, middle, left, vsplit

## Infrastructure as Code

.column[
* The good parts: it's code!
* The bad parts: it's code!
]

.column[

```
resource "google_sql_database instance" "master" {
name = "master-instance"
database_version = "POSTGRES_11"
region = "us-centra1"
settings {
    tier = "db-f1-micro"
  }
}
```

]

---


class: nord-dark, middle, left, vsplit

## Infrastructure as Data

.column[
* Manage infrastructure using a declarative model
* Treats infrastructure as data, more portable than code
* Data can be imported/modified by other tools
* Language agnostic, version controlled
]

.column[
```
apiVersion: sql.cnrm.cloud.google.com/v1beta1
  kind: SQLInstance
  metadata:
    name: sqlinstance-sample-mysql
  spec:
    databaseVersion: MYSQL_5_7
    region: us-central1
  settings:
    tier: db-g1-small
    diskSize: 25
    diskType: PD_SSD
    availabilityType: REGIONAL
    backupConfiguration:
    binaryLogEnabled: true
    enabled: true
```
]

---

class: nord-dark, middle, left

### The goal: Make security visible

---

class: nord-dark, middle, left

### What we can make visible

* Difference between domains TLS/DMARC settings and "good"?
* Totals within/differences between groups of domains
* Trends for domains/groups towards "good"
* Where things stand now

---

class: nord-dark, middle, left

### But there is so much more we want to make visible...

---

class: nord-dark, middle, left

### Important security information exists at every layer

* Platform
* Infrastructure
* Languages
* Dependencies
* Workflow (who, and how)
* Application code
* Inputs & validation

---

class: nord-dark, middle, left

### Very little of this is visible from the outside

* Platform
* Infrastructure
* Languages
* Dependencies
* Workflow (who, and how)
* Application code
* Inputs & validation

---

class: nord-dark, left, middle

### Analyzing any of this requires data

* Platform: *data*
* Infrastructure: *data*
* Languages: *data*
* Dependencies: *data*
* Workflow (who, and how): *data*
* Application code: *data*
* Inputs & validation: *data*

---

class: nord-dark, left, middle

### Can we build Tracker so that it can been analyzed?

* Make the "behind the scenes" stuff visible?
* Make it easy to answer "are we vulnerable"?

---

class: nord-dark, left, middle

### Tracker as a testbed: * as data

* Platform: *Kubernetes*
* Infrastructure: *Config Connector*
* Languages: *GitHub API*
* Dependencies: *GitHub API*
* Workflow (who, and how): *GitHub API*
* Application code: ? (CodeQL?)
* Inputs & validation: *GraphQL*

---

class: nord-dark, center, middle

## Platform as data: Kubernetes

---

class: nord-dark, middle, left

### Kubernetes
* describe your system with data
* executes that description
* *ensures system never deviates from the description*

.sync.sixty[![](images/kubernetes-sync.svg)]

---

class: nord-dark, middle, left


```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: tracker-frontend
  namespace: frontend
spec:
*  replicas: 2
  selector:
    matchLabels:
      app: tracker-frontend
  template:
    metadata:
      labels:
        app: tracker-frontend
    spec:
      containers:
*      - image: gcr.io/track-compliance/frontend:master-320b5fd
        name: frontend
        ports:
        - containerPort: 3000
```

---


class: nord-dark, left, middle

### When system descriptions are YAML
* Data for analysis
* Simplified operations

---

class: nord-dark, left, middle

### Operations

#### Deployment

```yaml
  -     - image: gcr.io/track-compliance/frontend:master-320b5fd
* +     - image: gcr.io/track-compliance/frontend:master-d07b6e0
```

#### Rollback

```yaml
* +     - image: gcr.io/track-compliance/frontend:master-320b5fd
  -     - image: gcr.io/track-compliance/frontend:master-d07b6e0
```

---

class: nord-dark, left, middle

### Analysis: Config on GitHub says...

```bash
$ git clone --depth 1 git@github.com:canada-ca/tracker.git && cd tracker
$ kustomize build platform/overlays/gke | \
>   yq 'select(.kind == "Service" and .spec.type == "LoadBalancer").spec.ports[].port'
80
443
```

---

class: nord-dark, left, middle

### Analysis: System on Google Cloud shows

```bash
$ sudo nmap -p- --reason pulse.alpha.canada.ca
[sudo] password for mike:
Starting Nmap 7.80 ( https://nmap.org ) at 2020-09-05 13:52 EDT
Nmap scan report for pulse.alpha.canada.ca (34.95.5.243)
Host is up, received syn-ack ttl 56 (0.046s latency).
rDNS record for 34.95.5.243: 243.5.95.34.bc.googleusercontent.com
Not shown: 65533 filtered ports
Reason: 65533 no-responses
PORT    STATE SERVICE REASON
* 80/tcp  open  http    syn-ack ttl 56 ğŸ‘€
* 443/tcp open  https   syn-ack ttl 56

Nmap done: 1 IP address (1 host up) scanned in 191.39 seconds
```

---

class: nord-dark, middle, left

### Why this works
* Data is on GitHub
* Changes flow through

.gitops.sixty[![gitops](images/gitops2.svg)]

---

class: nord-dark, middle, left

### Bringing these ideas to the infrastructure layer...

---

class: nord-dark, middle, left

## Infrastructure as data: Config Connector

---

class: nord-dark, middle, left

### Config Connector

* Describe GCP infra/services in Kubernetes data format
* Extends Kubernetes to act on these new types

.sync.sixty[![](images/config-connector-sync.svg)]

---

class: nord-dark, middle, left

### Hosted SQL database "as data"

```yaml
apiVersion: sql.cnrm.cloud.google.com/v1beta1
* kind: SQLInstance
metadata:
  name: sqluser-dep
spec:
  region: northamerica-northeast1
  databaseVersion: MYSQL_5_7
  settings:
    backupConfiguration:
        enabled: true
        binaryLogEnabled: true
        startTime: "18:00"
    ipConfiguration:
      requireSsl: true
    tier: db-n1-standard-1
```

---

class: nord-dark, middle, left


### When our description is YAML...

---

class: nord-dark, middle, left

### Business Continuity: How long to rebuild from scratch?

```yaml
apiVersion: sql.cnrm.cloud.google.com/v1beta1
 kind: SQLInstance
metadata:
  name: sqluser-dep
spec:
  region: northamerica-northeast1
  databaseVersion: MYSQL_5_7
  settings:
    backupConfiguration:
        enabled: true
        binaryLogEnabled: true
        startTime: "18:00"
    ipConfiguration:
      requireSsl: true
    tier: db-n1-standard-1
```

---

class: nord-dark, middle, left

### Policy: Meets data residency requirements?

```yaml
apiVersion: sql.cnrm.cloud.google.com/v1beta1
kind: SQLInstance
metadata:
  name: sqluser-dep
spec:
*  region: northamerica-northeast1
  databaseVersion: MYSQL_5_7
  settings:
    backupConfiguration:
        enabled: true
        binaryLogEnabled: true
        startTime: "18:00"
    ipConfiguration:
      requireSsl: true
    tier: db-n1-standard-1
```

---

class: nord-dark, middle, left

### Operations: Are backups getting done?

```yaml
apiVersion: sql.cnrm.cloud.google.com/v1beta1
kind: SQLInstance
metadata:
  name: sqluser-dep
spec:
  region: northamerica-northeast1
  databaseVersion: MYSQL_5_7
  settings:
*    backupConfiguration:
*        enabled: true
        binaryLogEnabled: true
        startTime: "18:00"
    ipConfiguration:
      requireSsl: true
    tier: db-n1-standard-1
```

---

class: nord-dark, middle, left

### Security: Encryption in transit?

```yaml
apiVersion: sql.cnrm.cloud.google.com/v1beta1
kind: SQLInstance
metadata:
  name: sqluser-dep
spec:
  region: northamerica-northeast1
  databaseVersion: MYSQL_5_7
  settings:
    backupConfiguration:
        enabled: true
        binaryLogEnabled: true
        startTime: "18:00"
    ipConfiguration:
*      requireSsl: true
    tier: db-n1-standard-1
```

---

class: nord-dark, middle, left

### Unlike Word Docs, data is dual use
* Always up to date because it's needed for operations
* YAML is human readable, supporting manual analysis
* YAML is machine readable supporting automated analysis

---

class: nord-dark, middle, left

### Data as documentation
* We can ensure this documentation reflects reality

.gitopscc.eighty[![gitops](images/gitops.svg)]

---

class: nord-dark, middle, left

### Can we build Tracker so that it can been analyzed?

* More than we thought!
* Everything from service accounts to input validation is visible from the outside

---

class: nord-dark, left, middle

### Tracker is now data that can be input to some other process

---


class: nord-dark, left, middle

### The ingredients for an automated ATO?

* Kubernetes: 56 data types
* Config Connector: 91 data types
* 147 Lego blocks, that can build any system (we use ~35)
* Each has ~2-10 properties relevant to answering our questions:
  * Does it meet policy requirements?
  * Is it configured securely?
  * Does it follow best practice?

---

class: nord-dark, middle, left

### Automated ATO PoC

```bash
$ cat sqlinstance.yaml
apiVersion: sql.cnrm.cloud.google.com/v1beta1
kind: SQLInstance
metadata:
  name: sqluser-dep
spec:
  region: northamerica-northeast1
  databaseVersion: MYSQL_5_7
  settings:
    backupConfiguration:
      enabled: true
      binaryLogEnabled: true
      startTime: "18:00"
    ipConfiguration:
      requireSsl: true
    tier: db-n1-standard-1

```
---

class: nord-dark, middle, left, smaller-text

### Automated ATO PoC

```bash
$ cat sqlinstance.yaml | ./itsg
{
  "CP-9": {
    "name": "Information System Backup",
    "satisfiedBy": [
      {
        "default:SQLInstance:sqluser-dep": "spec.settings.backupConfiguration.enabled: true"
      }
    ]
  },
  "PE-18": {
    "name": "Location Of Information System Components",
    "satisfiedBy": [
      {
        "default:SQLInstance:sqluser-dep": "spec.region: northamerica-northeast1"
      }
    ]
  },
  "SC-8": {
    "name": "Transmission Confidentiality And Integrity",
    "satisfiedBy": [
      {
        "default:SQLInstance:sqluser-dep": "spec.settings.ipConfiguration.requireSsl: true"
      }
    ]
  }
}


```

---


class: nord-dark, left, middle

### We (GoC) need experiments like this

* We need a lot of new services
* Shipping shouldn't require accepting a tonne of risk

---

class: nord-dark, left, middle

### We (Security) need experiments like this

* Dev: ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©ğŸ©<br/>
* Ops: ğŸ¦†ğŸ¦†ğŸ¦†ğŸ¦†ğŸ¦†ğŸ¦†ğŸ¦†ğŸ¦†ğŸ¦†ğŸ¦†
* Sec: ğŸˆ

---

class: nord-dark, left, middle

### Making security visible empowers everyone to work on this problem

* Dev: ğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆ<br/>
* Ops: ğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆ
* Sec: ğŸˆ

---

class: nord-dark, middle, center

## Fin



    </textarea>

    <script src="js/remark.min.js"></script>
    <script>
      var slideshow = remark.create({
        ratio: "16:9",
        highlightStyle: "dark",
        highlightLines: true,
        countIncrementalSlides: false,
        navigation: {
          scroll: false,
          touch: true,
          click: false
        }
      });

    </script>
  </body>
</html>
